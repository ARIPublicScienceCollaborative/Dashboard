<!DOCTYPE html>

    <html>

        <head>
            
            <meta name="description" content="ARI Exploration">
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width">
             
            <title>ARI</title>
            
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

            <!--Add Leaflet CSS-->
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
            <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
            <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
            
            <!--Load in Heat plugin -->
            <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
            <script src="https://code.jquery.com/jquery-3.1.0.js"></script>  
            
            <!--KVS geoJSON-->    
            <script src="StateOutlets.geojson"></script>
            <script src="BurlingtonSAI"></script>
            <script src ="MarshalltownSAI"></script>
            <script src = "AlcRelatedCrashes"></script>
            <script src= "StateOffOutlets_2019"></script>
            <script src = "StateOnOutlets_2019"></script>
            <script src = "schools"></script>
            <script src = "IowaCitySAI"></script>
            <script src = "CedarRapidsSAI"></script>
            <script src = "OnOutletCluster"></script>
            <script src = "OffOutletCluster"></script>


             <!--Boot Strap-->
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

      
            <!--External CSS for Markers -->
            <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">	-->
            <!--<link rel="stylesheet" href="https://profseeger.github.io/LVM-Code/classes/Leaflet.awesome-markers/leaflet.awesome-markers.css">-->
            <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">-->
            <!--<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">-->
            <!--<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />-->


            <!--External JS for Markers-->	
            <!--<script src="https://code.jquery.com/jquery-3.1.0.js"></script>-->
            <!--<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>-->
            <!--<script src="https://profseeger.github.io/LVM-Code/classes/Leaflet.awesome-markers/leaflet.awesome-markers.js"></script>-->

            <!--AwesomeMarker-->
           <!-- <link href=“http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css” rel=“stylesheet”> -->
          <!--  <link rel=“stylesheet” href=“https://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css”> -->
         <!--  <link rel=“stylesheet” href=“ARIWebMapping/Home/Health/PlugIn/PlugIn/awesomemarkers/dist/leaflet.awesome-markers.css” /> -->
       <!--     <script src= "PlugIn/PlugIn/awesomemarkers/dist/leaflet.awesome-markers.js"></script> -->
        

        <script src = "Leaflet.SvgShapeMarkers-gh-pages/dist/leaflet-svg-shape-markers.min.js"></script>
            <!--Boot Strap-->
              <link rel=“stylesheet” href=“https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css”> 
              <link rel=“stylesheet” href=“https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css”> 

             <div class="navbar">
                <a href="https://kvanselous.github.io/ARIDashboard/">Home</a>
                <a href="https://kvanselous.github.io/ARIDashboard/Sales/">Sales</a>
                <a href="https://publicsciencecollaborative.shinyapps.io/abd_tobacco/">Tobacco</a>
                <a href="https://kvanselous.github.io/ARIDashboard/Violations/">Violations</a>
                <a href="https://kvanselous.github.io/ARIDashboard/Health/">Health & Safety</a>
                <a href="https://kvanselous.github.io/ARIDashboard/Deliverables/">Deliverable List</a>
            </div>
              

                <style>
 
                    h1 {text-align: center; font-size: 50px}
                    h2 {text-align: center; margin-left: 10px}
                    h3 {text-align: center; margin-left: 10px}
                    h4 {margin-left: 10px}
                    h5 {margin-left: 10px}

                    .center {
                    display: block;
                    margin-left: auto;
                    margin-right: auto;
                    width: 25%;
                    } 
                   
                    #map1container {border: 1px solid#0a0a0a;  position:absolute; background-color:#ecf7fc; color:black; text-align:left; margin-right: 0px; margin-left:5px; width:600px; height:790px;padding 0; }
                    #map1 {border: 1px solid#0a0a0a;  position: relative; width:1000px; height:790px; margin-left:600px;border-left:2px; padding 0; overflow:hidden;}
                    #map2container {border: 1px solid#0a0a0a; position:absolute; background-color:#fdfdfd; color:black; text-align:left; margin-right: 0px; margin-left:5px; width:600px; height:790px;padding 0; }
                    #map2 {border: 1px solid#0a0a0a; position: relative; width:1000px; height:790px; margin-left:600px;border-left:2px; padding 0; overflow:hidden;} 
                    #map3container {border: 1px solid#0a0a0a; position:absolute; background-color:#ecf7fc; color:black; text-align:left; margin-right: 0px; margin-left:5px; width:600px; height:790px;padding 0; }
                    #map3 {border: 1px solid#0a0a0a; position: relative; width:1000px; height:790px; margin-left:600px;border-left:2px; padding 0; overflow:hidden;}
                    #map4container {border: 1px solid#0a0a0a; position:absolute; background-color:#fdfdfd; color:black; text-align:left; margin-right: 0px; margin-left:5px; width:600px; height:790px;padding 0; }
                    #map4 {border: 1px solid#0a0a0a; position: relative; width:1000px; height:790px; margin-left:600px;border-left:2px; padding 0; overflow:hidden;}         


                    /* The navigation bar */
                    .navbar {
                    overflow: hidden;
                    background-color: #333;
                    position: relative; /* Set the navbar to fixed position */
                    top: 0; /* Position the navbar at the top of the page */
                    width: 100%; /* Full width */
                    }

                    /* Links inside the navbar */
                    .navbar a {
                    float: left;
                    display: block;
                    color: #f2f2f2;
                    text-align: center;
                    padding: 14px 16px;
                    text-decoration: none;
                    }

                    /* Change background on mouse-over */
                    .navbar a:hover {
                    background: #ddd;
                    color: black;
                    }

                    /* Main content */
                    .main {
                    margin-top: 30px; /* Add a top margin to avoid content overlay */
                    }

                     /* Legend */
                    .legend {
                        line-height: 18px;
                        color: #555;
                        background color:cornsilk
                        }
                    .legend i {
                        width: 20px;
                        height: 20px;
                        float: left;
                        margin-right: 8px;
                        opacity: 0.7;
                        }
                    .info {
                        padding: 6px 8px;
                        font: 20px/20px Arial, Helvetica, sans-serif;
                        background: white;
                        background: rgba(255,255,255,0.8);
                        box-shadow: 0 0 15px rgba(0,0,0,0.2);
                        border-radius: 5px;
                        }
                    .info h4 {
                        margin: 0 0 5px;
                        color: #777;
                        }
                        
                    .legend .circle {
                        border-radius: 50%;
                        width: 10px;
                        height: 10px;
                        margin-top: 8px;
                        }

                    .legend .triangle {
                        border-radius: 50%;
                        width: 10px;
                        height: 10px;
                        margin-top: 8px;
                        }
                </style>
        
        </head>

    <body>   
           
        <!--Title-->
     
             
        <img src="ARI.jpg" height=55% width=55% >
        <img src="logonew.jpg" height=35% width=35% class="top-left" >
        
      
        <!--Headings and Maps-->
        <h3>Deliverable 7: Create choropleth maps that project spatial variation in health and safety data throughout Iowa. Linking these data with the data described in items 1-6 above, create layered maps that combine point-level data (e.g. the locations of compliance violations) with choropleth data that enable the spatial analysis of patterns of association between health and safety variables and liquor and tobacco data, including the identification of ‘hot spots’</h3>
        <h2>Alcohol Outlets & Call for Service </h2>   
        <div id='map1container'>
            <h2>Cedar Rapids Outlets </h2>   
            <h4><b>Background:</b> Alcohol Outlet Density </h4>
            <h4><b>Map:</b> The map to the right displays.   </h4>
            <h4><b>Interactivity:</b> Click on.  </h4>     
            <img src=CedarRapidsSummary.png>  
            </div>
            
        <div id='map1' class="center">
        </div>
        <div id='map2container'>
            <h2>Iowa City Outlets </h2>   
            <h4><b>Background:</b> Alcohol Outlet Density</h4>  
            <h4><b>Map:</b> The map to the right displays.  </h4>
            <h4><b>Interactivity:</b> Click on.</h4> 
            <img src=IowaCitySummary.png>            
            </div>
        <div id='map2' class="center">
        </div>
       
        <div id='map3container'>
            <h2>Marshalltown Outlets </h2>   
            <h4><b>Background:</b> Alcohol Outlet Density</p>  
            <h4><b>Map:</b> The map to the right displays.  </h4>
            <h4><b>Interactivity:</b> Click on.</h4>  
            <img src=MarshalltownSummary.png>           
            </div>
        <div id='map3' class="center"></div>
    

        <div id='map4container'>
        <h2>Burlington Outlets </h2>   
        <h4><b>Background:</b> Alcohol Outlet Density</h4>  
        <h4><b>Map:</b> The map to the right displays.  </h4>
        <h4><b>Interactivity:</b> Click on.</h4> 
        <img src=BurlingtonSummary.png>           
        </div>
        <div id='map4' class="center"></div>

            <script>   
                         
                    //Cedar Rapids Maps, Marker Information, Layers, & Layer Control
                    var map1 = L.map('map1').setView([41.96, -91.6656], 11.5);
                    L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 18,
                        id: 'mapbox/streets-v11',
                        accessToken: 'pk.eyJ1Ijoia3ZhbnNlbG91cyIsImEiOiJjazZsbHE2NGwwZDdtM2tvNmRjc2N0NHo5In0.h_W_-4R3haPMK-IDBTcL-w' 
                        }).addTo(map1);      
                    
                    var circle1 = {
                        radius: 5,
                        fillColor: "darkgreen",
                        color: "black",
                        weight: .5,
                        opacity: 1,
                        fillOpacity: 0.8
                        };   

                    var circle2 = {
                        radius: 5,
                        fillColor: "darkblue",
                        color: "grey",
                        weight: .5,
                        opacity: 1,
                        fillOpacity: 0.8
                        };    
                

                        function highlightFeature(e) {
                         var layer = e.target;
                            layer.setStyle({
                            weight: 5,
                            color: '#666',
                            dashArray: '',
                            fillOpacity: 0.7
                        });
                        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                            layer.bringToFront();
                        }
                    }

                function resetHighlightCO(e) {
                                CSAI.resetStyle(e.target);
                                }
                function resetHighlightCF(e) {
                                CSAI_family.resetStyle(e.target);
                                }
                function resetHighlightCV(e) {
                                CSAI_violent.resetStyle(e.target);
                                }   
                function resetHighlightCA(e) {
                                CSAI_alc.resetStyle(e.target);
                                }                              
                function resetHighlightCNA(e) {
                                CSAI_narralc.resetStyle(e.target);
                                }                              
                function resetHighlightCOn(e) {
                                CSAI_On.resetStyle(e.target);
                                }        
                function resetHighlightCOff(e) {
                                CSAI_Off.resetStyle(e.target);
                                }                           
                                            
                        function onEachFeatureCO(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightCO
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b> Density Score of Outlets: </b>" + feature.properties.SAIoutlet_miles.toFixed(2) +
                                                    "<br> <b> Number of Alcohol Outlets: </b> " + feature.properties.outlet_count +
                                                    "<br> <b> Number of On-Premise Alcohol Outlets: </b> " + feature.properties.Onoutlet_count + 
                                                    "<br> <b> Number of Off-Premise Alcohol Outlets: </b> " + feature.properties.Offoutlet_count + 
                                                    "<br> <b> Number of Family Related Calls For Service: </b> " + feature.properties.family_count + 
                                                    "<br> <b> Number of Violent Crime Related Calls For Service: </b> " + feature.properties.violent_count + 
                                                    "<br> <b> Number of Alcohol Related Calls For Service: </b> " + feature.properties.alc1_count +
                                                    "<br> <b> Number of Narrowed Alcohol Related Calls For Service: </b> " + feature.properties.narralc1_count + 
                                                    "<br> <b> Number of Alcohol Related Car Crashes: </b> " + feature.properties.crash_count );
                                    }
                                    }
                        
                        function onEachFeatureCF(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightCF
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Family Calls for Service: </b>" + feature.properties.SAIfamily_miles.toFixed(2) );
                                    }
                                    }
                        
                        function onEachFeatureCV(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightCV
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Violent Crime Calls for Service: </b>" + feature.properties.SAIviolent_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureCA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightCA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Alcohol Crime Calls for Service: </b>" + feature.properties.SAIalc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureCNA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightCNA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Narrowed Alcohol Crime Calls for Service: </b>" + feature.properties.SAInarralc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureCOn(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightCOn
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI On-Premise Alcohol Outlets: </b>" + feature.properties.SAIOnoutlet_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureCOff(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightCOff
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Off-Premise Alcohol Outlets: </b>" + feature.properties.SAIOffoutlet_miles.toFixed(2) );
                                    }
                                    }

                
              var on= L.geoJSON(onoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).bringToFront(100);
                    
                var off= L.geoJSON(offoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle2);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).bringToFront(100);

            

                var schools = L.geoJSON(schools,  { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                             return   L.shapeMarker(coordinates, {
                            color: "black",
                            fillColor: "purple",        
                            shape: "triangle",
                            radius: 5,
                            weight: .5,
                            fillOpacity: 0.8
	                        });
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.feature_na)
                            },
                            } 
                            ).bringToFront(100);

                var crashes = L.geoJSON(crashes,  { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.shapeMarker(coordinates, {
                            color: "darkred",      
                            shape: "x",
	                    	radius: 10,
                            weight: 2
	                        });
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Severity: </b>" + feature.properties.CSEVERITY )
                            },
                            } 
                            ).bringToFront(100);
                

                function getColorC1(d) {
                            return   d > 16.077736? '#c67718' :
                                d > 9.313716   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }

                        
                function getColorC2(d) {
                            return  d > 54.233366 ? '#c67718' :
                                d > 33.255352   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }

                       
                function getColorC3(d) {
                            return  d > 24.517983 ? '#c67718' :
                                d > 11.9551   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }

                        
                function getColorC4(d) {
                            return  d > 15.673219 ? '#c67718' :
                                d > 9.075954   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }

                        
                function getColorC5(d) {
                            return  d > 12.095957 ? '#c67718' :
                                d > 7.046176   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }

                function getColorC6(d) {
                            return  d > 11.455359 ? '#c67718' :
                                d > 6.968766   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        

                function getColorC7(d) {
                            return  d > 11.668378 ? '#c67718' :
                                d > 7.248416  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }

                        
                function styleC1(feature) {
                            return {
                                fillColor: getColorC1((feature.properties.SAIoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }


                function styleC2(feature) {
                            return {
                                fillColor: getColorC2((feature.properties.SAIfamily_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                function styleC3(feature) {
                            return {
                                fillColor: getColorC3((feature.properties.SAIviolent_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                function styleC4(feature) {
                            return {
                                fillColor: getColorC4((feature.properties.SAIalc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                function styleC5(feature) {
                            return {
                                fillColor: getColorC5((feature.properties.SAInarralc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                       
                function styleC6(feature) {
                            return {
                                fillColor: getColorC6((feature.properties.SAIOnoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                function styleC7(feature) {
                            return {
                                fillColor: getColorC7((feature.properties.SAIOffoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleOn(feature) {
                            return {
                                fillColor: 'darkgreen',
                                weight: 3,
                                opacity: 1,
                                radius: 10, 
                                color: 'darkgreen',
                                fillOpacity: 0.2
                            };
                        }

                        function styleOff(feature) {
                            return {
                                fillColor: 'darkblue',
                                weight: 3,
                                opacity: 1,
                                color: 'darkblue',
                                fillOpacity: 0.2
                            };
                        }


                        var CSAI = L.geoJson(Cdata, {style: styleC1, onEachFeature: onEachFeatureCO}).bringToBack(0).addTo(map1);
                        var CSAI_family = L.geoJson(Cdata, {style: styleC2, onEachFeature: onEachFeatureCF}).bringToBack(0);
                        var CSAI_violent= L.geoJson(Cdata, {style: styleC3, onEachFeature: onEachFeatureCV}).bringToBack(0);
                        var CSAI_alc= L.geoJson(Cdata, {style: styleC4, onEachFeature: onEachFeatureCA}).bringToBack(0);
                        var CSAI_narralc= L.geoJson(Cdata, {style: styleC5, onEachFeature: onEachFeatureCNA}).bringToBack(0);
                        var CSAI_On= L.geoJson(Cdata, {style: styleC6, onEachFeature: onEachFeatureCOn}).bringToBack(0);
                        var CSAI_Off= L.geoJson(Cdata, {style: styleC7, onEachFeature: onEachFeatureCOff}).bringToBack(0);
                        var deselect = L.geoJson(Mdata, {style: styleC1, onEachFeature: onEachFeatureCO}).bringToBack(0);
                        var ConClusters =  L.geoJson(onoutletcluster, {style: styleOn});
                        var CoffClusters =  L.geoJson(offoutletcluster, {style: styleOff})

                        var basemapC1 = {
                        "Neighborhood Density, On & Off-Premise": CSAI,
                        "Neighborhood Density, On-Premise": CSAI_On,
                        "Neighborhood Density, Off-Premise": CSAI_Off,    
                        "Family Calls for Service": CSAI_family,
                        "Violent Crime Calls for Service": CSAI_violent,
                        "Alcohol Calls for Service": CSAI_alc,
                        "Narrowed Alcohol Calls for Service": CSAI_narralc,
                        "Deselect Census Block Data": deselect
                           };  


                    var overlayMapsC1 = {
                        "Alcohol Outlets, On-Premise": on,
                        "Alcohol Outlets, Off-Premise": off,
                        "Alcohol Outlet Clusters, On-Premise": ConClusters,
                        "Alcohol Outlet Clusters, Off-Premise": CoffClusters,
                        "K-12 Schools, Pubic & Private": schools, 
                        "Alchol-Related Automobile Crashes": crashes
                        };			

                    L.control.layers(basemapC1, overlayMapsC1).addTo(map1);	

//                    var legend1 = L.control({position: 'bottomleft'}); 
//                        legend1.onAdd = function (map1) {
//                            var div = L.DomUtil.create('div', 'info legend');
//                            grades = [" On-Premise", " Off-Premise", " School", " Crash"],
//                            labels = ["circleMarker(circle1)", "offMarker.png", "schoolMarker.png", "crashMarker.png"];
//                        for (var i = 0; i < grades.length; i++) {
//                               div.innerHTML +=
//                              (" <img src="+ labels[i] +" height='20' width='20'>") + grades[i] +'<br>';
//                                }
// 
//                        return div;
//                         } ;
//                         legend1.addTo(map1)


var legend1 = L.control({position: 'bottomleft'}); 
                        legend1.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["pointLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height='120' width='140'>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend1.addTo(map1)
                                            

                    var legend2 = L.control({position: 'bottomright'}); 
                        legend2.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["DensityLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height=150 width=120>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend2.addTo(map1)
                                                    


                //Iowa city Maps
                var map2 = L.map('map2').setView([41.653, -91.5302], 13);
                        L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 18,
                        id: 'mapbox/streets-v11',
                        accessToken: 'pk.eyJ1Ijoia3ZhbnNlbG91cyIsImEiOiJjazZsbHE2NGwwZDdtM2tvNmRjc2N0NHo5In0.h_W_-4R3haPMK-IDBTcL-w' 
                        }).addTo(map2);      

                function resetHighlightIO(e) {
                                ISAI.resetStyle(e.target);
                                }
                function resetHighlightIF(e) {
                                ISAI_family.resetStyle(e.target);
                                }
                function resetHighlightIV(e) {
                                ISAI_violent.resetStyle(e.target);
                                }   
                function resetHighlightIA(e) {
                                ISAI_alc.resetStyle(e.target);
                                }                              
                function resetHighlightINA(e) {
                                ISAI_narralc.resetStyle(e.target);
                                }                              
                function resetHighlightIOn(e) {
                                ISAI_On.resetStyle(e.target);
                                }        
                function resetHighlightIOff(e) {
                                ISAI_Off.resetStyle(e.target);
                                }                           
                                            
                        function onEachFeatureIO(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightIO
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Outlets: </b>" + feature.properties.SAIoutlet_miles.toFixed(2) );
                                    }
                                    }
                        
                        function onEachFeatureIF(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightIF
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Family Calls for Service: </b>" + feature.properties.SAIfamily_miles.toFixed(2) );
                                    }
                                    }
                        
                        function onEachFeatureIV(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightIV
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Violent Crime Calls for Service: </b>" + feature.properties.SAIviolent_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureIA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightIA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Alcohol Crime Calls for Service: </b>" + feature.properties.SAIalc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureINA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightINA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Narrowed Alcohol Crime Calls for Service: </b>" + feature.properties.SAInarralc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureIOn(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightIOn
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI On-Premise Alcohol Outlets: </b>" + feature.properties.SAIOnoutlet_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureIOff(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightIOff
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Off-Premise Alcohol Outlets: </b>" + feature.properties.SAIOffoutlet_miles.toFixed(2) );
                                    }
                                    }

                

               var on= L.geoJSON(onoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).setZIndex(1);
                    
                var off= L.geoJSON(offoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle2);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).setZIndex(1);

                
                        function getColorI1(d) {
                            return  d > 10.818359 ? '#c67718' :
                                d > 8.117004  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorI2(d) {
                            return  d > 47.062782 ? '#c67718' :
                                d > 21.856973   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                       
                         function getColorI3(d) {
                            return  d > 17.47147 ? '#c67718' :
                                d > 11.108533   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorI4(d) {
                            return  d > 21.468809 ? '#c67718' :
                                d > 12.954804   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorI5(d) {
                            return  d > 21.024899 ? '#c67718' :
                                d > 12.55983  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                       
                         function getColorI6(d) {
                            return  d > 10.43857 ? '#c67718' :
                                d > 6.97192   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        

                        function getColorI7(d) {
                            return  d > 8.558648 ? '#c67718' :
                                d > 7.012553   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        function styleI1(feature) {
                            return {
                                fillColor: getColorI1((feature.properties.SAIoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleI2(feature) {
                            return {
                                fillColor: getColorI2((feature.properties.SAIfamily_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleI3(feature) {
                            return {
                                fillColor: getColorI3((feature.properties.SAIviolent_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                        function styleI4(feature) {
                            return {
                                fillColor: getColorI4((feature.properties.SAIalc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleI5(feature) {
                            return {
                                fillColor: getColorI5((feature.properties.SAInarralc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                       
                        function styleI6(feature) {
                            return {
                                fillColor: getColorI6((feature.properties.SAIOnoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleI7(feature) {
                            return {
                                fillColor: getColorI7((feature.properties.SAIOffoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }



                        var ISAI = L.geoJson(Idata, {style: styleI1, onEachFeature: onEachFeatureIO}).addTo(map2);
                        var ISAI_family = L.geoJson(Idata, {style: styleI2, onEachFeature: onEachFeatureIF});
                        var ISAI_violent= L.geoJson(Idata, {style: styleI3, onEachFeature: onEachFeatureIV});
                        var ISAI_alc= L.geoJson(Idata, {style: styleI4, onEachFeature: onEachFeatureIA});
                        var ISAI_narralc= L.geoJson(Idata, {style: styleI5, onEachFeature: onEachFeatureINA});
                        var ISAI_On= L.geoJson(Idata, {style: styleI6, onEachFeature: onEachFeatureIOn});
                        var ISAI_Off= L.geoJson(Idata, {style: styleI7, onEachFeature: onEachFeatureIOff});
                        var deselect = L.geoJson(Cdata, {style: styleC1, onEachFeature: onEachFeatureIO});
                        var IonClusters =  L.geoJson(onoutletcluster, {style: styleOn})
                        var IoffClusters =  L.geoJson(offoutletcluster)

                        var basemapI1 = {
                        "Neighborhood Density, On & Off-Premise": ISAI,
                        "Neighborhood Density, On-Premise": ISAI_On,
                        "Neighborhood Density, Off-Premise": ISAI_Off,    
                        "Family Calls for Service": ISAI_family,
                        "Violent Crime Calls for Service": ISAI_violent,
                        "Alcohol Calls for Service": ISAI_alc,
                        "Narrowed Alcohol Calls for Service": ISAI_narralc,
                        "Deselect Census Block Data": deselect
                           };  

                var overlayMapsI1 = {
                    "Alcohol Outlets, On-Premise": on,
                        "Alcohol Outlets, Off-Premise": off,
                        "Alcohol Outlet Clusters, On-Premise": IonClusters,
                        "Alcohol Outlet Clusters, Off-Premise": IoffClusters,
                        "K-12 Schools, Pubic & Private": schools, 
                        "Alchol-Related Automobile Crashes": crashes
                        };				

                    L.control.layers(basemapI1, overlayMapsI1).addTo(map2);	

                    var legend1 = L.control({position: 'bottomleft'}); 
                        legend1.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["pointLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height='120' width='140'>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend1.addTo(map2)

                    var legend2 = L.control({position: 'bottomright'}); 
                        legend2.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["DensityLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height=150 width=120>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend2.addTo(map2)

                //Marshalltown Maps
                var map3 = L.map('map3').setView([42.035, -92.9080], 13);
                            L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
                            maxZoom: 18,
                            id: 'mapbox/streets-v11',
                            accessToken: 'pk.eyJ1Ijoia3ZhbnNlbG91cyIsImEiOiJjazZsbHE2NGwwZDdtM2tvNmRjc2N0NHo5In0.h_W_-4R3haPMK-IDBTcL-w' 
                            }).addTo(map3);     

                function resetHighlightMO(e) {
                                MSAI.resetStyle(e.target);
                                }
                function resetHighlightMF(e) {
                                MSAI_family.resetStyle(e.target);
                                }
                function resetHighlightMV(e) {
                                MSAI_violent.resetStyle(e.target);
                                }   
                function resetHighlightMA(e) {
                                MSAI_alc.resetStyle(e.target);
                                }                              
                function resetHighlightMNA(e) {
                                MSAI_narralc.resetStyle(e.target);
                                }                              
                function resetHighlightMOn(e) {
                                MSAI_On.resetStyle(e.target);
                                }        
                function resetHighlightMOff(e) {
                                MSAI_Off.resetStyle(e.target);
                                }                           
                                            
                        function onEachFeatureMO(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightMO
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Outlets: </b>" + feature.properties.SAIoutlet_miles.toFixed(2) );
                                    }
                                    }
                        
                        function onEachFeatureMF(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightMF
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Family Calls for Service: </b>" + feature.properties.SAIfamily_miles.toFixed(2) );
                                    }
                                    }
                        
                        function onEachFeatureMV(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightMV
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Violent Crime Calls for Service: </b>" + feature.properties.SAIviolent_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureMA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightMA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Alcohol Crime Calls for Service: </b>" + feature.properties.SAIalc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureMNA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightMNA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Narrowed Alcohol Crime Calls for Service: </b>" + feature.properties.SAInarralc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureMOn(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightMOn
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI On-Premise Alcohol Outlets: </b>" + feature.properties.SAIOnoutlet_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureMOff(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightMOff
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Off-Premise Alcohol Outlets: </b>" + feature.properties.SAIOffoutlet_miles.toFixed(2) );
                                    }
                                    }


                var on= L.geoJSON(onoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).setZIndex(1);
                    
                var off= L.geoJSON(offoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle2);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).setZIndex(1);

                                

                        function getColorm1(d) {
                            return  d > 15.056157 ? '#c67718' :
                                d > 9.340565   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorm2(d) {
                            return  d > 70.338594 ? '#c67718' :
                                d > 28.471514   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                       
                         function getColorm3(d) {
                            return  d > 57.488513 ? '#c67718' :
                                d > 20.215948  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorm4(d) {
                            return  d > 30.389875 ? '#c67718' :
                                d > 15.68   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorm5(d) {
                            return  d > 30.389875 ? '#c67718' :
                                d > 15.68   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                       
                         function getColorm6(d) {
                            return  d > 12.41227 ? '#c67718' :
                                d > 8.577117   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        

                        function getColorm7(d) {
                            return  d > 12.124179 ? '#c67718' :
                                d > 7.963968  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        

                        function stylem1(feature) {
                            return {
                                fillColor: getColorm1((feature.properties.SAIoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function stylem2(feature) {
                            return {
                                fillColor: getColorm2((feature.properties.SAIfamily_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function stylem3(feature) {
                            return {
                                fillColor: getColorm3((feature.properties.SAIviolent_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                        function stylem4(feature) {
                            return {
                                fillColor: getColorm4((feature.properties.SAIalc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function stylem5(feature) {
                            return {
                                fillColor: getColorm5((feature.properties.SAInarralc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                       
                        function stylem6(feature) {
                            return {
                                fillColor: getColorm6((feature.properties.SAIOnoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function stylem7(feature) {
                            return {
                                fillColor: getColorm7((feature.properties.SAIOffoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        var MSAI = L.geoJson(Mdata, {style: stylem1, onEachFeature: onEachFeatureMO}).addTo(map3);
                        var MSAI_family = L.geoJson(Mdata, {style: stylem2, onEachFeature: onEachFeatureMF});
                        var MSAI_violent= L.geoJson(Mdata, {style: stylem3, onEachFeature: onEachFeatureMV});
                        var MSAI_alc= L.geoJson(Mdata, {style: stylem4, onEachFeature: onEachFeatureMA});
                        var MSAI_narralc= L.geoJson(Mdata, {style: stylem5, onEachFeature: onEachFeatureMNA});
                        var MSAI_On= L.geoJson(Mdata, {style: stylem6, onEachFeature: onEachFeatureMOn});
                        var MSAI_Off= L.geoJson(Mdata, {style: stylem7, onEachFeature: onEachFeatureMOff});
                        var MOnClusters =  L.geoJson(onoutletcluster, {style: styleOn});
                        var MOffClusters =  L.geoJson(offoutletcluster, {style: styleOff});

                        var basemapM1 = {
                         "Neighborhood Density, On & Off-Premise": MSAI,
                        "Neighborhood Density, On-Premise": MSAI_On,
                        "Neighborhood Density, Off-Premise": MSAI_Off,    
                        "Family Calls for Service": MSAI_family,
                        "Violent Crime Calls for Service": MSAI_violent,
                        "Narrowed Alcohol Calls for Service": MSAI_narralc,
                        "Deselect Census Block Data": deselect
                           };  
                          

                var overlayMapsM1 = {
                        "Alcohol Outlets, On-Premise": on,
                        "Alcohol Outlets, Off-Premise": off,
                        "Alcohol Outlet Clusters, On-Premise": MOnClusters,
                        "Alcohol Outlet Clusters, Off-Premise": MOffClusters,
                        "K-12 Schools, Pubic & Private": schools, 
                        "Alchol-Related Automobile Crashes": crashes
                        };			




                    L.control.layers(basemapM1, overlayMapsM1).addTo(map3);	
    
                    var legend1 = L.control({position: 'bottomleft'}); 
                        legend1.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["pointLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height='120' width='140'>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend1.addTo(map3)

                    var legend2 = L.control({position: 'bottomright'}); 
                        legend2.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["DensityLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height=150 width=120>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend2.addTo(map3) 
                 
                 //Burlington Maps
                 var map4 = L.map('map4').setView([40.8077, -91.1129], 13);
                        L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 18,
                        id: 'mapbox/streets-v11',
                        accessToken: 'pk.eyJ1Ijoia3ZhbnNlbG91cyIsImEiOiJjazZsbHE2NGwwZDdtM2tvNmRjc2N0NHo5In0.h_W_-4R3haPMK-IDBTcL-w' 
                        }).addTo(map4);      

                function resetHighlightBO(e) {
                                BSAI.resetStyle(e.target);
                                }
                function resetHighlightBF(e) {
                                BSAI_family.resetStyle(e.target);
                                }
                function resetHighlightBV(e) {
                                BSAI_violent.resetStyle(e.target);
                                }   
                function resetHighlightBA(e) {
                                BSAI_alc.resetStyle(e.target);
                                }                              
                function resetHighlightBNA(e) {
                                BSAI_narralc.resetStyle(e.target);
                                }                              
                function resetHighlightBOn(e) {
                                BSAI_On.resetStyle(e.target);
                                }        
                function resetHighlightBOff(e) {
                                BSAI_Off.resetStyle(e.target);
                                }                           
                                              
                        function onEachFeatureBO(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightBO
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Outlets: </b>" + feature.properties.SAIoutlet_miles.toFixed(2) );
                                    }
                                    }
                        
                        function onEachFeatureBF(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightBF
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Family Calls for Service: </b>" + feature.properties.SAIfamily_miles.toFixed(2) );
                                    }
                                    }
                        
                        function onEachFeatureBV(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightBV
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Violent Crime Calls for Service: </b>" + feature.properties.SAIviolent_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureBA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightBA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Alcohol Crime Calls for Service: </b>" + feature.properties.SAIalc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureBNA(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightBNA
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Narrowed Alcohol Crime Calls for Service: </b>" + feature.properties.SAInarralc1_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureBOn(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightBOn
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI On-Premise Alcohol Outlets: </b>" + feature.properties.SAIOnoutlet_miles.toFixed(2) );
                                    }
                                    }

                        function onEachFeatureBOff(feature, layer) {
                                layer.on({
                                    mouseover: highlightFeature,
                                    mouseout: resetHighlightBOff
                                });
                                if (feature.properties) {
                                    layer.bindPopup("<b>SAI Off-Premise Alcohol Outlets: </b>" + feature.properties.SAIOffoutlet_miles.toFixed(2) );
                                    }
                                    }

                var on= L.geoJSON(onoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).setZIndex(1);
                    
                var off= L.geoJSON(offoutlets, { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates, circle2);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Name: </b>" + feature.properties.doing_business_as +
                            "<br> <b>Address: </b>" + feature.properties.address +  
                            "<br><b>Year: </b>" + feature.properties.sixmosactiveyear +
                            "<br><b>Number Of Licenses: </b>" + feature.properties.numlics 
                             )},
                        }).setZIndex(1);

                        function getColorb1(d) {
                            return  d > 18.655517 ? '#c67718' :
                                d > 11.181537   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorb2(d) {
                            return  d > 93.572398  ? '#c67718' :
                                d > 41.012965  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                       
                         function getColorb3(d) {
                            return  d > 42.339382 ? '#c67718' :
                                d > 15.42154   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorb4(d) {
                            return  d > 21.988759 ? '#c67718' :
                                d > 15.697262  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                        
                        function getColorb5(d) {
                            return  d > 21.806145 ? '#c67718' :
                                d > 14.388295  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        
                         function getColorb6(d) {
                            return  d > 13.31623 ? '#c67718' :
                                d > 8.846507   ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        

                        function getColorb7(d) {
                            return  d > 11.594403 ? '#c67718' :
                                d > 7.737363  ? '#fbb664' :
                                d > 0   ? '#fed9ad80' :
                                            '#white';
                                            }
                        

                        function styleb1(feature) {
                            return {
                                fillColor: getColorb1((feature.properties.SAIoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleb2(feature) {
                            return {
                                fillColor: getColorb2((feature.properties.SAIfamily_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleb3(feature) {
                            return {
                                fillColor: getColorb3((feature.properties.SAIviolent_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                        function styleb4(feature) {
                            return {
                                fillColor: getColorb4((feature.properties.SAIalc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleb5(feature) {
                            return {
                                fillColor: getColorb5((feature.properties.SAInarralc1_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }
                       
                        function styleb6(feature) {
                            return {
                                fillColor: getColorb6((feature.properties.SAIOnoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        function styleb7(feature) {
                            return {
                                fillColor: getColorb7((feature.properties.SAIOffoutlet_miles)),
                                weight: 2,
                                opacity: 1,
                                color: 'black',
                                fillOpacity: 0.7
                            };
                        }

                        var BSAI = L.geoJson(Bdata, {style: styleb1, onEachFeature: onEachFeatureBO}).addTo(map4);
                        var BSAI_family = L.geoJson(Bdata, {style: styleb2, onEachFeature: onEachFeatureBF});
                        var BSAI_violent= L.geoJson(Bdata, {style: styleb3, onEachFeature: onEachFeatureBV});
                        var BSAI_alc= L.geoJson(Bdata, {style: styleb4, onEachFeature: onEachFeatureBA});
                        var BSAI_narralc= L.geoJson(Bdata, {style: styleb5, onEachFeature: onEachFeatureBNA});
                        var BSAI_On= L.geoJson(Bdata, {style: styleb6, onEachFeature: onEachFeatureBOn});
                        var BSAI_Off= L.geoJson(Bdata, {style: styleb7, onEachFeature: onEachFeatureBOff});
                        var BOnClusters =  L.geoJson(onoutletcluster, {style: styleOn});
                        var BOffClusters =  L.geoJson(offoutletcluster, {style: styleOff});


                        var basemapB1 = {
                            "Neighborhood Density, On & Off-Premise": BSAI,
                        "Neighborhood Density, On-Premise": BSAI_On,
                        "Neighborhood Density, Off-Premise": BSAI_Off,    
                        "Family Calls for Service": BSAI_family,
                        "Violent Crime Calls for Service": BSAI_violent,
                        "Alcohol Calls for Service": BSAI_alc,
                        "Narrowed Alcohol Calls for Service": BSAI_narralc,
                        "Deselect Census Block Data": deselect
                           };  



                var overlayMapsB1 = {
                         "Alcohol Outlets, On-Premise": on,
                        "Alcohol Outlets, Off-Premise": off,
                        "Alcohol Outlet Clusters, On-Premise": BOnClusters,
                        "Alcohol Outlet Clusters, Off-Premise": BOffClusters,
                        "K-12 Schools, Pubic & Private": schools, 
                        "Alchol-Related Automobile Crashes": crashes
                        };			



                    L.control.layers(basemapB1, overlayMapsB1).addTo(map4);	

                    var legend4 = L.control({position: 'bottomleft'}); 
                        legend4.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["pointLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height='120' width='140'>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend4.addTo(map4)

                    var legend2 = L.control({position: 'bottomright'}); 
                        legend2.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [""],
                            labels = ["DensityLegend.png"];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height=150 width=120>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend2.addTo(map4)
    
		             
            </script>
        
        </body>
        
</html>